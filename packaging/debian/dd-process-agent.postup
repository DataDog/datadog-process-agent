#!/bin/sh

# source functions library
. /lib/lsb/init-functions

PIDFILE=/opt/sts-process-agent/run/sts-process-agent.pid
DAEMON=/opt/sts-process-agent/bin/sts-process-agent
CONFIG=/etc/dd-agent/sts-process-agent.ini

# Exit if the package is not installed
[ -x "$DAEMON" ] || exit 0

# make sts-process-agent start on boot
echo "Adding sts-process-agent to start on boot..."
update-rc.d -f sts-process-agent defaults

echo "Starting sts-process-agent..."
export DD_PROCESS_AGENT_ENABLED=true
start-stop-daemon --start --quiet --oknodo --background \
--make-pidfile --pidfile $PIDFILE --chuid dd-agent \
--startas /bin/bash -- -c \
"exec $DAEMON -config=$CONFIG >> /var/log/sts-process-agent.log 2>&1"
